<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>API</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src='main.js'></script>
</head>
<body style="text-align: center;">
    <h1>Ingresar</h1>
    <input id="login_email" placeholder="Email" type="text" />
    <input id="login_pw" placeholder="Clave" type="password" />
    <button onclick="login()">Entrar</button>

    <div style="padding: 20px;">O</div>

    <h1>Registrarse</h1>
    <input id="register_email" placeholder="Email" type="text" />
    <input id="register_pw" placeholder="Clave" type="password" />
    <button onclick="register()">Registrarse</button>

</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</html>

<script>

    let api_url = 'http://localhost:4000/';

    const login = () => {

        const email = document.getElementById('login_email').value;
        const pw = document.getElementById('login_pw').value;

        const user = {
            email: email,
            password: pw
        }

        axios
            .post(api_url+'api/login', user)
            .then((response) => {
                localStorage.setItem('token',response.data.token);
                window.location.href = "/profile";
            })
            .catch((error) => alert("Email o clave incorrecto."));
            
}

    const register = () => {

        const email = document.getElementById('register_email').value;
        const pw = document.getElementById('register_pw').value;

        (async () => {
            const rawResponse = await fetch(api_url+'api/signup', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                email: email,
                password: pw
                })
            }).then(function (response) {
                if(response.ok){
                    alert("Registrado correctamente.");
                }else{
                    alert("No se pudo registrar.");
                }
            });

        })();

    }
</script>